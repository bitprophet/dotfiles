# TODO: read this out of ~/aether/invoke.yml?
export NIX_PATH="nixpkgs=/nix/pkgs:nixos-config=/etc/nixos/configuration.nix"

# Always want sudo and --fast with nixos-rebuild:
# - no manually building nixpkgsUnstable, which might override my pinned ver
# - show traces when kaboom (huh. no longer the case in 21.11?)
# - some subset of functionality CAN run w/o sudo but having to remember which
#   is which would be a PITA so who gives a shit
alias nixos-rebuild="sudo nixos-rebuild --fast"
alias nr="nixos-rebuild"

# Kinda-sorta 'list installed packages'
export NIX_SYSTEM_LOCATIONS=(/run/current-system/sw /etc/static)
alias whats-installed='nix-store --query --requisites ${NIX_SYSTEM_LOCATIONS} | cut -d "-" -f 2- | sort'
function deps-of () {
    nix-store --query --requisites $(which $1)
}

# I never remember exactly how to "just run a .nix file" (typically some form
# of extracting a module from nixos/nixpkgs)
function build() {
    nix-build -v --show-trace -E "with import <nixpkgs> {}; callPackage $1 {}" $2
}
